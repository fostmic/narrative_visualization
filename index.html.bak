<!DOCTYPE html>
<html>
  <head>
	<script src='https://d3js.org/d3.v5.js'></script>
	<script src='https://github.com/susielu/d3-annotation/blob/master/d3-annotation.js'></script>
  </head>
<!--<style> circle {fill: lightblue; stroke: black;} </style>-->
  <body onload='init()'>
    <div id="header" style="width: 500px; text-align: center;"><b>Lake Mead Water Elevation(feet)</b></div>
    <div id="viz" style="width: 500px;"></div>
	<br>
	<div id ="buttons" style="width: 500px;">
      <button id="back" onclick="goBack()" disabled>Back</button>
      <button id="forward" style="float: right;" onclick="goForward()">Forward</button>
    </div>
    <script>
	
	
	var margin = {top: 10, right: 10, bottom: 25, left: 50},
	width = 500 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;
	
	var svg = d3.select("#viz")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform",
                      "translate(" + margin.left + "," + margin.top + ")");
      
	var state = 0; // state of the viz
	
	var x,y;
    
    async function init() {
	        
    //Read the data
    d3.csv('https://fostmic.github.io/narrative_visualization/Lake_Mead_Formatted.csv',


    function(d){
      return { date : d3.timeParse("%Y-%m-%d")(d.date), value : d.elevation_ft }
    },


    function(data) {
		
	//console.log(data);

      // X axis
      x = d3.scaleTime()
	  .domain([new Date(1935,1,15), new Date(1937,5,31)])
      .range([ 0, width ]);
	  
      svg.append("g")
	  .attr("id", "x_axis")
      .attr("transform", "translate(0," + height + ")")
      .call(d3.axisBottom(x));

      // Add Y axis
      y = d3.scaleLinear()
      .domain([700, 1250])
      .range([ height, 0 ]);
	  
      svg.append("g")
	  .attr("id", "y_axis")
      .call(d3.axisLeft(y));

     // Add line
      svg.append("path")
	  .attr("id", "path")
      .datum(data)
	  .attr("stroke", "blue")
      .attr("fill", "none")
      .attr("d", d3.line()
        .x(function(d) { return x(d.date) })
        .y(function(d) { return y(d.value) }))

    }
    )
    }
	  
	  
	  function loadState(state) {
	    switch(state) {
		case 0:
		  document.getElementById("back").disabled = true;

		  	x = d3.scaleTime()
	       .domain([new Date(1935,1,15), new Date(1937,5,31)])
           .range([ 0, width ]);
	  
		   svg.select("#x_axis")
		   .transition().duration(1500)
           .call(d3.axisBottom(x));
		   
		   svg.select("#path")
		   .transition().duration(1500)
		   .attr("d", d3.line()
           .x(function(d) { return x(d.date) })
           .y(function(d) { return y(d.value) }));
		  
		
		  break;
		
		case 1:
		   document.getElementById("back").disabled = false;
		   
		   x = d3.scaleTime()
	       .domain([new Date(1935,1,15), new Date(1998,11,15)])
           .range([ 0, width ]);
	  
		   svg.select("#x_axis")
		   .transition().duration(1500)
           .call(d3.axisBottom(x));
		   
		   svg.select("#path")
		   .transition().duration(1500)
		   .attr("d", d3.line()
           .x(function(d) { return x(d.date) })
           .y(function(d) { return y(d.value) }));
		  
		  break;
		  
		case 2:
		  document.getElementById("forward").disabled = false;
		  
		  		   x = d3.scaleTime()
	       .domain([new Date(1935,1,15), new Date(2022,7,1)])
           .range([ 0, width ]);
	  
		   svg.select("#x_axis")
		   .transition().duration(1500)
           .call(d3.axisBottom(x));
		   
		   svg.select("#path")
		   .transition().duration(1500)
		   .attr("d", d3.line()
             .x(function(d) { return x(d.date) })
             .y(function(d) { return y(d.value) }));
		  
		  break;
		
		case 3:
		  document.getElementById("forward").disabled = true;
		  break;
		
		}
	  }
	  
	  
      function goBack() {
        if (state != 0) 
		{
		  state -= 1;
		  loadState(state);
		}
      }
 
      function goForward() {
        if (state != 3) 
		{
		  state += 1;
		  loadState(state);
		}
      }
  
</script>
</body>
</html>