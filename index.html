<!DOCTYPE html>
<html>
  <head>
	<script src='https://d3js.org/d3.v4.js'></script>
	<script src='https://github.com/susielu/d3-annotation/blob/master/d3-annotation.js'></script>
  </head>
<!--<style> circle {fill: lightblue; stroke: black;} </style>-->
  <body onload='init()'>
    <div id="header" style="width: 500px; text-align: center;"><b>Lake Mead Water Elevation(feet)</b></div>
    <div id="viz" style="width: 500px;"></div>
	<br>
	<div id ="buttons" style="width: 500px;">
      <button id="back" onclick="goBack()" disabled>Back</button>
      <button id="forward" style="float: right;" onclick="goForward()">Forward</button>
    </div>
    <script>
	
	
	var margin = {top: 10, right: 10, bottom: 25, left: 50},
	width = 500 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;
	
    var margintt = {top: 0, right: 0, bottom: 25, left: 50},
	widthtt = 400 - margintt.left - margintt.right,
    heighttt = 400 - margintt.top - margintt.bottom;
	
	var svg = d3.select("#viz")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform",
                      "translate(" + margin.left + "," + margin.top + ")");
      
	var state = 0; // state of the viz
	
	
	var svgtooltipGorge = d3.select("body")
    .append("div")
	//.text("a simple tooltip")
    //.style("position", "absolute")
    .style("z-index", "7")
    .style("visibility", "hidden")
	.style("float", "left")
    //.style("background", "white")
    .append("svg")
    .attr("width", widthtt + margintt.left + margintt.right)
    .attr("height", heighttt + margintt.top + margintt.bottom)
	.attr("x", "0px")
    .append("g")
    .attr("transform",
        "translate(" + margintt.left + "," + margintt.top + ")");	
	
	
	
	//var svgtooltipGorge = d3.select("body")
    //.append("div")
    //.style("position", "absolute")
    //.style("z-index", "10")
    //.style("visibility", "hidden")
	//.style("background", "white")
    //.text("a simple tooltip");
	
	
	
	
	
	var x,y;
    
    async function init() {
	
	
	//Read the Gorge data
    d3.csv('https://fostmic.github.io/narrative_visualization/Flaming_Gorge_Reservoir_1968_2022.csv',


    function(d){
      return { date : d3.timeParse("%Y-%m-%d")(d.date), value : d.elevation_ft }
    },


    function(data) {
		
	//console.log(data);

      // X axis
      x = d3.scaleTime()
	  .domain(d3.extent(data, function(d) { return d.date; }))
      .range([ 0, widthtt ]);
	  
      svgtooltipGorge.append("g")
	  .attr("id", "x_axis")
      .attr("transform", "translate(0," + heighttt + ")")
      .call(d3.axisBottom(x));

      // Y axis
      y = d3.scaleLinear()
      .domain(d3.extent(data, function(d) { return d.value; }))
      .range([ heighttt, 0 ]);
	  
      svgtooltipGorge.append("g")
	  .attr("id", "y_axis")
      .call(d3.axisLeft(y));

     // line
      svgtooltipGorge.append("path")
	  .attr("id", "path")
      .datum(data)
	  .attr("stroke", "blue")
      .attr("fill", "none")
      .attr("d", d3.line()
        .x(function(d) { return x(d.date) })
        .y(function(d) { return y(d.value) }))

    }
    )
	
	
	
	
	
	

	
	        
    //Read the Mead data
    d3.csv('https://fostmic.github.io/narrative_visualization/Lake_Mead_Formatted.csv',


    function(d){
      return { date : d3.timeParse("%Y-%m-%d")(d.date), value : d.elevation_ft }
    },


    function(data) {
		
	//console.log(data);

      // X axis
      x = d3.scaleTime()
	  .domain([new Date(1935,1,15), new Date(1937,5,31)])
      .range([ 0, width ]);
	  
      svg.append("g")
	  .attr("id", "x_axis")
      .attr("transform", "translate(0," + height + ")")
      .call(d3.axisBottom(x));

      // Y axis
      y = d3.scaleLinear()
      .domain([700, 1250])
      .range([ height, 0 ]);
	  
      svg.append("g")
	  .attr("id", "y_axis")
      .call(d3.axisLeft(y));

     // line
      svg.append("path")
	  .attr("id", "path")
      .datum(data)
	  .attr("stroke", "blue")
      .attr("fill", "none")
      .attr("d", d3.line()
        .x(function(d) { return x(d.date) })
        .y(function(d) { return y(d.value) }))

    }
    )
    }
	  
	  
	  function loadState(state) {
	    switch(state) {
		case 0:
		  document.getElementById("back").disabled = true;

		  	x = d3.scaleTime()
	       .domain([new Date(1935,1,15), new Date(1937,5,31)])
           .range([ 0, width ]);
	  
		   svg.select("#x_axis")
		   .transition().duration(1500)
           .call(d3.axisBottom(x));
		   
		   svg.select("#path")
		   .transition().duration(1500)
		   .attr("d", d3.line()
           .x(function(d) { return x(d.date) })
           .y(function(d) { return y(d.value) }));
		  
		
		  break;
		
		case 1:
		   document.getElementById("back").disabled = false;
		   
		   x = d3.scaleTime()
	       .domain([new Date(1935,1,15), new Date(1998,11,15)])
           .range([ 0, width ]);
	  
		   svg.select("#x_axis")
		   .transition().duration(1500)
           .call(d3.axisBottom(x));
		   
		   svg.select("#path")
		   .transition().duration(1500)
		   .attr("d", d3.line()
           .x(function(d) { return x(d.date) })
           .y(function(d) { return y(d.value) }));
		  
		  break;
		  
		case 2:
		  document.getElementById("forward").disabled = false;
		  
		      if (svg.select("#x_axis").size() == 0) {
		        document.getElementById("header").innerHTML = "<b>Lake Mead Water Elevation(feet)</b>";
		        svg.selectAll('*').remove();
		        svg.append("g")
                  .attr("transform",
                        "translate(" + margin.left + "," + margin.top + ")");
			    
                d3.csv('https://fostmic.github.io/narrative_visualization/Lake_Mead_Formatted.csv',
			    
			    
                 function(d){
                   return { date : d3.timeParse("%Y-%m-%d")(d.date), value : d.elevation_ft }
                 },
	             
	             
                 function(data) {
	             	
	             //console.log(data);
	             
                   // X axis
                   x = d3.scaleTime()
	               .domain([new Date(1935,1,15), new Date(2022,8,1)])
                   .range([ 0, width ]);
	               
                   svg.append("g")
	               .attr("id", "x_axis")
                   .attr("transform", "translate(0," + height + ")")
                   .call(d3.axisBottom(x));
	             
                   // Y axis
                   y = d3.scaleLinear()
                   .domain([700, 1250])
                   .range([ height, 0 ]);
	               
                   svg.append("g")
	               .attr("id", "y_axis")
                   .call(d3.axisLeft(y));
	             
                  // line
                   svg.append("path")
	               .attr("id", "path")
                   .datum(data)
	               .attr("stroke", "blue")
                   .attr("fill", "none")
                   .attr("d", d3.line()
                     .x(function(d) { return x(d.date) })
                     .y(function(d) { return y(d.value) }))
	             
                 }
                 )
			   }
			   else
			   {
		          x = d3.scaleTime()
	              .domain([new Date(1935,1,15), new Date(2022,8,1)])
                  .range([ 0, width ]);
		          
		          svg.select("#x_axis")
		          .transition().duration(1500)
                  .call(d3.axisBottom(x));
		          
		          svg.select("#path")
		          .transition().duration(1500)
		          .attr("d", d3.line()
                  .x(function(d) { return x(d.date) })
                  .y(function(d) { return y(d.value) }));			     
			   }
		  
		  break;
		
		case 3:
		  document.getElementById("forward").disabled = true;
		  document.getElementById("header").innerHTML = "<b>Selected Colorado Basin Bodies of Water</b>";
		  
		  svg.selectAll('*').remove();
		  
		  
		  const circleX = 20;
          const circleY = 250;
          const radius = 20;
          
          
          // Define the arrowhead marker variables
          const markerBoxWidth = 20;
          const markerBoxHeight = 20;
          const refX = markerBoxWidth / 2;
          const refY = markerBoxHeight / 2;
          const markerWidth = markerBoxWidth / 2;
          const markerHeight = markerBoxHeight / 2;
          const arrowPoints = [[0, 0], [0, 20], [20, 10]];

          // Define the line variables
          const lineLength = 40;
          const lineStart = [circleX + radius, circleY];
          const lineEnd = [lineStart[0] + lineLength, circleY];
		  const lineStart2 = [lineEnd[0] + (radius * 2) + markerWidth, circleY];
          const lineEnd2 = [lineStart2[0] + lineLength, circleY];
		  const lineStart3 = [lineEnd2[0] + (radius * 2) + markerWidth, circleY];
          const lineEnd3 = [lineStart3[0] + lineLength, circleY];
		  const lineStart4 = [lineEnd3[0] + (radius * 2) + markerWidth, circleY];
          const lineEnd4 = [lineStart4[0] + lineLength, circleY];


          
          // Add the arrowhead marker definition to the svg element
          svg
            .append('defs')
            .append('marker')
            .attr('id', 'arrow')
            .attr('viewBox', [0, 0, markerBoxWidth, markerBoxHeight])
            .attr('refX', refX)
            .attr('refY', refY)
            .attr('markerWidth', markerBoxWidth)
            .attr('markerHeight', markerBoxHeight)
            .attr('orient', 'auto-start-reverse')
            .append('path')
            .attr('d', d3.line()(arrowPoints))
            .attr('stroke', 'black');
			
	       svg
			.append('text')
			.attr('x', 25)
			.attr('y', 200)
			.text('MouseOver the Circles to Show a Graph of Historical Water Elevation Below')
			.style("font-size", "12px");
          
          // Add the first circle
          svg
            .append('circle')
            .attr('cx', circleX)
            .attr('cy', circleY)
            .attr('r', radius)
            .style('fill', 'lightblue')
			.on("mouseover", function(){return svgtooltipGorge.style("visibility", "visible");})
            //.on("mousemove", function(){return svgtooltipGorge.style("top", (event.pageY-10)+"px").style("left",+"0px");})
            .on("mouseout", function(){return svgtooltipGorge.style("visibility", "hidden");});

	      svg
			.append('text')
			.attr('x', circleX - 30)
			.attr('y', circleY + 40)
			.text('Flaming Gorge')
			.style("font-size", "10px");
			
          
          // Add the line with arrowhead at the end
          svg
            .append('path')
            .attr('d', d3.line()([lineStart, lineEnd]))
            .attr('stroke', 'black')
            .attr('marker-end', 'url(#arrow)')
            .attr('fill', 'none');
          
          // Add the second circle
          svg
            .append('circle')
            .attr('cx', lineEnd[0] + markerWidth + radius)
            .attr('cy', circleY)
            .attr('r', radius)
            .style('fill', 'lightblue');
	      svg
			.append('text')
			.attr('x', lineEnd[0] + markerWidth + radius - 25)
			.attr('y', circleY + 40)
			.text('Lake Powell')
			.style("font-size", "10px");
			
			
		  // Add the line with arrowhead at the end
          svg
            .append('path')
            .attr('d', d3.line()([lineStart2, lineEnd2]))
            .attr('stroke', 'black')
            .attr('marker-end', 'url(#arrow)')
            .attr('fill', 'none');
          
          // Add the third circle
          svg
            .append('circle')
            .attr('cx', lineEnd2[0] + markerWidth + radius)
            .attr('cy', circleY)
            .attr('r', radius)
            .style('fill', 'lightblue');
	      svg
			.append('text')
			.attr('x', lineEnd2[0] + markerWidth + radius - 25)
			.attr('y', circleY + 40)
			.text('Lake Mead')
			.style("font-size", "10px");
			
          	  
          // Add the line with arrowhead at the end
          svg
            .append('path')
            .attr('d', d3.line()([lineStart3, lineEnd3]))
            .attr('stroke', 'black')
            .attr('marker-end', 'url(#arrow)')
            .attr('fill', 'none');
          
          // Add the fourth circle
          svg
            .append('circle')
            .attr('cx', lineEnd3[0] + markerWidth + radius)
            .attr('cy', circleY)
            .attr('r', radius)
            .style('fill', 'lightblue');
	      svg
			.append('text')
			.attr('x', lineEnd3[0] + markerWidth + radius - 26)
			.attr('y', circleY + 40)
			.text('Lake Mojave')
			.style("font-size", "10px");			
		  
		 // Add the line with arrowhead at the end
          svg
            .append('path')
            .attr('d', d3.line()([lineStart4, lineEnd4]))
            .attr('stroke', 'black')
            .attr('marker-end', 'url(#arrow)')
            .attr('fill', 'none');
          
          // Add the fifth circle
          svg
            .append('circle')
            .attr('cx', lineEnd4[0] + markerWidth + radius)
            .attr('cy', circleY)
            .attr('r', radius)
            .style('fill', 'lightblue');
	      svg
			.append('text')
			.attr('x', lineEnd4[0] + markerWidth + radius - 30)
			.attr('y', circleY + 40)
			.text('Lake Havasau')
			.style("font-size", "10px");	
		  
		  break;
		}
	  }
	  
	  
      function goBack() {
        if (state != 0) 
		{
		  state -= 1;
		  loadState(state);
		}
      }
 
      function goForward() {
        if (state != 3) 
		{
		  state += 1;
		  loadState(state);
		}
      }
  
</script>
</body>
</html>